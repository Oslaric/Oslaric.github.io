(()=>{var e={76:(e,t,n)=>{n(946),n(844),n(392);var r=n(946);n(844),n(392);logger.debug("going to load basic.js "),readerInput.onScroll=function(e,t){this.delegateImpl.onScroll(e,t)},readerInput.reportReadingProgress=function(e){this.delegateImpl.reportReadingProgress(e)},readerInput.reportTrueReadingProgressInfo=function(e){this.delegateImpl.reportTrueReadingProgressInfo(e)},readerInput.mark=function(e,t){this.delegateImpl.mark(e,t)},readerInput.addNote=function(e,t){var n=this.delegateImpl.addNote(e,t);return JSON.stringify(n)},readerInput.markNote=function(e){this.delegateImpl.markNote(e)},readerInput.loadMarks=function(e){this.delegateImpl.loadMarks(e)},readerInput.deleteMark=function(){this.delegateImpl.deleteMark()},readerInput.gotoAnchor=function(e){this.delegateImpl.gotoAnchor(e)},readerInput.loadAnchorsResponse=function(e){this.delegateImpl.loadAnchorsResponse(e)},readerInput.changeFontSize=function(e){this.delegateImpl.changeFontSize(e)},readerInput.unfreezeReadingRange=function(){this.delegateImpl.unfreezeReadingRange()},readerInput.changeMode=function(e){this.delegateImpl.changeMode(e)},readerInput.handleScreenRotationBefore=function(e){this.delegateImpl.handleScreenRotationBefore(e)},readerInput.handleScreenRotationAfter=function(e){this.delegateImpl.handleScreenRotationAfter(e)};var o={onDocumentReady:function(){readerMessager.sendSuccessMessage("onDocumentReady",null)},onDocSizeChanges:function(e,t,n){var r={docSize:e,scrollY:n};readerMessager.sendSuccessMessage("onDocSizeChanges",r)},onSaveProgress:function(e){readerMessager.sendSuccessMessage("onSaveProgress",e)},onReportTrueReadingProgressInfo:function(e){readerMessager.sendSuccessMessage("onReportTrueReadingProgressInfo",e)},onNewSelectionExist:function(e,t,n){var r={rect:e,selectedRenderText:t,sentence:n};readerMessager.sendSuccessMessage("onNewSelectionExist",r)},onClickNonSelectionArea:function(e){readerMessager.sendSuccessMessage("onClickNonSelectionArea",e)},onClickMark:function(e,t,n,r,o){var i={markId:e,rect:t,selectedText:n,sentence:r,hasNote:o};readerMessager.sendSuccessMessage("onClickMark",i)},onMarkCreated(e,t,n,r,o,i,a){var s={markId:e,markClass:t,removeMarkIds:n,percentRate:r,location:o,text:i,isNoting:a};readerMessager.sendSuccessMessage("onMarkCreated",s)},onMarkClassChange(e,t){readerMessager.sendSuccessMessage("onMarkClassChange",{markId:e,markClass:t})},requestToLoadMarks(e,t){readerMessager.sendSuccessMessage("requestToLoadMarks",{percentRate:e,pageSize:t})},loadAnchorsRequest(){readerMessager.sendSuccessMessage("loadAnchorsRequest",0)},onAnchorReachRequest(e){readerMessager.sendSuccessMessage("onAnchorReachRequest",e)},onClickImage(e){readerMessager.sendSuccessMessage("onClickImage",e)}},i=3,a=[Node.ELEMENT_NODE,Node.TEXT_NODE,Node.DOCUMENT_FRAGMENT_NODE];function s(e,t){return null!=e&&null!=t&&e.toLowerCase()==t.toLowerCase()}function l(e=!0){let t=document.body;if(0==t.children.length)return 0;var n=t.lastElementChild.getBoundingClientRect().bottom,r=Math.abs(t.scrollHeight-t.offsetHeight);return n+(e?r:0)}function c(){let e=function(){const e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)}();if(null==document.body.lastElementChild)return e;let t=l();var n=0;return n=e-t>100?t:e,logger.trace("getDocHeight : "+n),n}function d(e,t){o.onDocSizeChanges(e,0,t),null!=t&&v(t)}function u(e){if(""==e)return 0;var t=document.getElementById(e);return t||(t=document.getElementsByName(e)[0]),t?t.getBoundingClientRect().y:null}function f(e){logger.debug("findRangeForLocation , location  : ",JSON.stringify(e));let t=h(e.xpathLocation);return null==t?null:t.nativeRange}function h(e){var t=r.createRange(),n=function(e){var t=e.split("//");e=t.length>1?t[1]:t[0];t=e.split("/");for(var n=document.body,r="[@id=",o=0;o<t.length;o++){var i=t[o];if(0!=i.length){var a=i.indexOf(r);if(-1!=a){a+=r.length+1;var s=i.indexOf("]",a)-1,l=i.slice(a,s);n=document.querySelector("#"+l)}else{var c=i.slice(0,i.indexOf("["));n=k(n,parseInt(i.slice(c.length+1,i.length-1)),c)}}}return n}(e.containerXPath);if(null==n)return logger.error("failed to find path : ",e.containerXPath),null;if(e.start==e.end&&0==e.start){var o=document.createRange();return o.selectNode(n),t.setStartAndEnd(o.startContainer,o.startOffset,o.endContainer,o.endOffset),t}return t.moveToBookmark({start:e.start,end:e.end,containerNode:n}),t}function g(e,t){if(logger.debug("whenDocSizeChanges begin "),logger.debug("feelwithme.init"+JSON.stringify(feelwithme.init)),0==feelwithme.init.state)return feelwithme.init.state=1,logger.debug("whenDocSizeChanges - initReadingPositionIfNeed "),void function(){const e=feelwithme.init.readingLocation;var t=c();if(null==e)return logger.debug("reportInitialSizeAndPosition: start from head"),void d(t,null);var n=0;if(1==e.locationType)return 0==e.anchorValue.trim().length?d(t,n):d(t,n=u(e.anchorValue)),void logger.debug("reportInitialSizeAndPosition: start from toc , y : ",n);var r=e.location;if(null!=r){var o=f(r);null!=o?(n=o.getBoundingClientRect().y,logger.debug("range content : ",o.toString(),"scroll Y : ",n)):n=null,logger.debug("reportInitialSizeAndPosition: start from mark , y : ",n),d(t,n),logger.debug("end reportInitialSizeAndPosition ")}else d(t,null)}();var n=c();if(function(e,t,n,r){if(null==n)return!0;var o=l(!1);return!(r>n&&n>=o||r<n&&e.length<2&&e[0].target==document.body)}(e,0,feelwithme.viewInfo.docHeight,n)){var r=feelwithme.readingLocate.range,i=null;null!=r?(i=r.getBoundingClientRect().y,logger.debug("readingPositionY from range : ",i)):(i=R(),logger.debug("readingPositionY from record : ",i)),feelwithme.viewInfo.docHeight!=n||feelwithme.readingLocate.reportScrollY!=i?(feelwithme.viewInfo.docHeight=n,feelwithme.readingLocate.reportScrollY=i,v(i),logger.debug("whenDocSizeChanges 000003 "),o.onDocSizeChanges(n,0,i)):logger.debug("whenDocSizeChanges nothing , skip")}}function p(e){"loading"!=document.readyState?e():window.addEventListener&&window.addEventListener("DOMContentLoaded",e)}function m(e){"complete"==document.readyState?e():window.addEventListener&&window.addEventListener("load",e)}function v(e){feelwithme.readingLocate.scrollY=e}function R(){return feelwithme.readingLocate.scrollY}function C(e,t){feelwithme.readingLocate.range=e,null!=e&&logger.debug("reset reading range , msg : ",t||""," rangeY : ",e.getBoundingClientRect().y,"range : ",e.startContainer,e.startOffset,e.endContainer,e.endOffset)}function N(e,t,n,r,o,i){for(var a,s,l,c,d=[e||document.body],u=!1,f=!1;!u&&(a=d.pop());){f=f||r(a);var h=o(a);if(n&&f&&h&&(u=i(a)),u)break;if(h)if(s=(l=a.childNodes).length,t)for(;s--;)d.push(l[s]);else{c=a.childNodes;for(var g=0;g<c;g++)d.push(l[g])}!n&&f&&h&&(u=i(a))}}function E(e){return function(t){return-1!=a.indexOf(t.nodeType)&&(!/SCRIPT|STYLE/.test(t.parentNode.tagName.toUpperCase())&&e(t))}}function y(e){var t=null,n=function(e){e=parseInt(e),logger.debug("findMostMatchNodeForScrollPosition : ",e);var t=null,n=null,r=null,o=null,a=document.createRange(),s=null,l=null,c=null,d=function(e){return!0};N(null,!0,!0,d=E(d),(function(t){return a.selectNode(t),s=a.getBoundingClientRect(),!(l>parseInt(s.top)&&null!=t.textContent&&0==t.textContent.trim().length&&s.bottom<1||(l=parseInt(s.top),c=parseInt(s.bottom),e<l||(c<=e&&(t.nodeType==i?r=t:o=t),0)))}),(function(r){if(l<=e&&e<c){if(r.nodeType==i)return t=r,!0;n=r}var o=e<l;return o&&logger.debug(" going to finish , node : ",r),o}));var u=[n,r,o].sort((function(t,n){if(null==t)return n;if(null==n)return t;a.selectNode(t);var r=Math.abs(e-a.getBoundingClientRect().y);return a.selectNode(n),r<Math.abs(e-a.getBoundingClientRect().y)?-1:1}));return{matchTextNode:t,candidateNode:u[0]}}(e);if(n.matchTextNode)logger.debug("ratation : matchTextNode : ",n.matchTextNode.textContent),t=function(e,t){var n=document.createRange();n.setStart(e,0),n.setEnd(e,e.length);var r=0,o=e.length;for(;o-r>1;){const i=Math.floor((r+o)/2);n.setStart(e,r),n.setEnd(e,i),n.getBoundingClientRect().bottom>t?o=i:r=i,o-r<50&&logger.debug("candidate text : ",n.toString())}o<e.length&&(r++,o++);return n.setStart(e,r),n.setEnd(e,o),logger.debug("candidate text final : ",n.toString()),n}(n.matchTextNode,e);else{var r=n.candidateNode||document.body;if(t=document.createRange(),3==r.nodeType){let e=r.length;t.setStart(r,e-1),t.setEnd(r,e)}else b(r)?(t.setStart(r,0),t.setEnd(r,0)):t.selectNode(r)}return t}function w(e){return-1!=[" ","\t","\n","\r"].indexOf(e)}function S(e){return-1!=[".",";","?","!","\n","\r","...","。","！","？","；"].indexOf(e)}function T(e,t,n){var r=e.getRangeAt(0);e.setBaseAndExtent(r.endContainer,r.endOffset,r.startContainer,r.startOffset),e.modify("extend","backward","sentence");var o=e.toString();return function(e,t){for(;t>=0&&w(e[t]);){if("\n"==e[t])return!0;t--}return t<0||S(e[t])}(o,o.length-t.length-1)?(e.removeAllRanges(),e.addRange(r)):(n+=o.length-t.length,t=o),r=e.getRangeAt(0),S(t[t.length-1])||(e.setBaseAndExtent(r.startContainer,r.startOffset,r.endContainer,r.endOffset),e.modify("extend","forward","sentence"),t=e.toString()),{locatorText:t,beginIndex:n}}function A(e,t,n=!0,r=50){return feelwithme.operationLocation.text=function(e,t,n=!0,r=50){var o={locatorVisibleText:"",selectionVisibleOffset:0,selectionVisibleLen:0,uniqueIndex:0,sentenceOffset:0,sentenceLen:0};if(e.startContainer==document.body.parentElement)return o;var i=function(){var e=window.getSelection();return e.removeAllRanges(),e}();i.addRange(e);var a=i.toString(),s=a,l=0,c=I("block",[i.anchorNode,i.focusNode]),d=!1;const u=50;var f=T(i,s,l);s=f.locatorText,l=f.beginIndex;var h=0,g=s.length;function p(e,t){for(var n=0;null!=t&&t!=e;)n++,t=t.parentNode;return n}var m=p(c,i.getRangeAt(0).startContainer),v=p(c,i.getRangeAt(0).endContainer);d=!1;function R(){d=s.length>=u||m<=0&&v<=0}R();for(;!d;){var C=i.getRangeAt(0);if(m>v){i.setBaseAndExtent(C.endContainer,C.endOffset,C.startContainer,C.startOffset),i.modify("extend","backward","sentence");var N=i.toString();if((y=p(c,i.focusNode))<=0)m=0;else{m=N.length==s.length?0:y;var E=N.length-s.length;l+=E,h+=E,s=N}}else{i.setBaseAndExtent(C.startContainer,C.startOffset,C.endContainer,C.endOffset),i.modify("extend","forward","sentence");var y;N=i.toString();(y=p(c,i.focusNode))<=0?v=0:(v=N.length==s.length?0:y,s=N)}R()}i.removeAllRanges(),!n||i.addRange(e);return{locatorVisibleText:s,selectionVisibleOffset:l,selectionVisibleLen:a.length,uniqueIndex:-1,sentenceOffset:h,sentenceLen:g}}(e,0,n,r),feelwithme.operationLocation.text}function x(e){return 1!=e.nodeType?"":(e.currentStyle||window.getComputedStyle(e,"")).display}function b(e){return"block"==x(e).toLowerCase()}function O(e,t=!0){var n=[];for(t||(e=e.parentNode);e&&(n.push(e),!s(e.tagName,document.body.tagName));)e=e.parentNode;return n}function I(e,t){for(var n=O(t[0]).reverse(),r=n.length-1,o=1;o<t.length;o++){let e=O(t[o]).reverse(),a=Math.min(e.length,r+1);for(var i=0;i<a;i++)if(n[i]!=e[i]){i-1<r&&(r=i-1);break}}var a=n[r];if(e)for(;x(a)!=e;)a=a.parentNode;return a}function M(e){for(var t=0,n=e.tagName;e=e.previousSibling;)s(e.tagName,n)&&++t;return t}function k(e,t,n){for(var r=e.firstChild,o=0;null!==r;r=r.nextSibling)if(s(r.tagName,n)&&++o==t)return r;return null}function D(e,t){return t?e.toString().trim():e.toString()}function _(e){var t=e.getBoundingClientRect(),n=t.y,r=c(),o=function(){const e=document.body,t=document.documentElement;return Math.max(e.scrollWidth,e.offsetWidth,t.clientWidth,t.scrollWidth,t.offsetWidth)}();return 0==r||0==o?0:n/r+t.x/o/1e6}function P(e,t,n){var r=A(e,0,n);return{sentenceText:r.locatorVisibleText.substr(r.sentenceOffset,r.sentenceLen),sentenceOffset:r.selectionVisibleOffset-r.sentenceOffset,partLength:r.selectionVisibleLen}}function H(e){if(feelwithme.loadMark.done)logger.debug("loadMarksIfNeed , done ");else{var t=e||R()||0;logger.debug("loadMarksIfNeed , scrollY : ",t);var n=0;t+3*(feelwithme.readerView.height||1e3)<(function(){if(null==feelwithme.tailMark)return null;var e=f(feelwithme.tailMark.location);return e?e.getBoundingClientRect().y:null}()||0)?logger.debug("loadMarksIfNeed no need to load more marks"):(feelwithme.tailMark&&null!=feelwithme.tailMark.percentRate&&(n=feelwithme.tailMark.percentRate),logger.debug("loadMarksIfNeed , rate : ",n),o.requestToLoadMarks(n,feelwithme.loadMark.pageSize))}}function L(e){var t=function(){for(var e=document.body.children,t=[document.body],n=e.length-1;n>-1;n--){var r=e[n];if(r.innerText.trim().length>0){t.push(r);break}}return 1==t.length&&e.length>0&&t.push(e[e.length-1]),t}(),n=new ResizeObserver((n=>{e(n,t)}));t.forEach((e=>n.observe(e))),feelwithme.resizeObserver=n}function B(e){if(null!=e){var t=function(e){if(null==e)return null;var t=feelwithme.anchor.lastIndex||0,n=feelwithme.anchor.list,r=n.length;if(0==r)return null;for(var o=feelwithme.viewPort.height||500,i=null,a=t;a<r;)null!=(l=u(s=n[a]))&&(l<e+o&&(i=s,feelwithme.anchor.lastIndex=a),a++);if(null!=i)return i;for(a=t-1;-1!=a;){var s,l;if(null!=(l=u(s=n[a]))){if(l<e+o){i=s,feelwithme.anchor.lastIndex=a;break}a--}}return i}(e);null!=t?o.onAnchorReachRequest(t):logger.debug("no anchor match , scrollY : ",e)}}function W(e,t=!0){t&&(e=e.cloneNode(!0));var n=function(){var e;return(e=document.getElementById("hiddenForRender"))||((e=document.createElement("div")).setAttribute("id","hiddenForRender"),e.setAttribute("style","opacity: 0.0;position: absolute;  left: -999999px;"),document.body.appendChild(e)),e}();n.appendChild(e);var r=n.innerText;return n.innerHTML="",r}function z(e,t,n){const r=t-e.x,o=n-e.y;return 0<=r&&r<e.width&&0<=o&&o<e.height}function F(e,t,n){var o=r.getSelection(),i=o.nativeSelection,a=o.getRangeAt(0),s=i.getRangeAt(0).cloneRange(),l=function(e){var t=function(e,t){for(var n=[],r=e.converter.rangeToCharacterRange(t),o=e.highlights,i=0;i<o.length;++i){o[i].characterRange.isContiguousWith(r)&&n.push(o[i])}return n}(rangyHighlighter,e),n=rangyHighlighter.getHighlightsInSelection()||[];return t.concat(n)}(a),c=function(e,t){for(var n=rangyHighlighter.converter.rangeToCharacterRange(t),r=0;r<e.length;r++){var o=e[r].characterRange;o.start<n.start&&(n.start=o.start),o.end>n.end&&(n.end=o.end)}return n}(l,a);rangyHighlighter.removeHighlights(l);var d=l.map((e=>V(e.id)));d=function(e,t){return t=t||[],t=t.filter((function(t){return t!==e})),t}(e,d);var u=rangyHighlighter.highlightCharacterRanges(t,[c])[0];feelwithme.lastHighlight=u,function(e,t,n){var r=n||e.hasNote;!r&&t&&(r=0!=t.filter((e=>e.hasNote=!0)).length);e.hasNote=r}(u,l,n),Y(e,u,l);let f=u.getRange().nativeRange;var h=function(e,t,n){e.removeAllRanges(),e.addRange(n);var r=D(e);return e.removeAllRanges(),e.addRange(t),r}(i,s,f),g=X(f,h,!1,!0);return{markId:e,markClass:t,removeMarkIds:d,percentRate:_(f),location:g,text:h,isNoting:n}}function V(e){return feelwithme.highlightIdToMarkId[e]}function j(e){var t=feelwithme.highlightIdToMarkId[e];delete feelwithme.highlightIdToMarkId[e],delete feelwithme.markIdTohighlightId[t]}function Y(e,t,n){!function(e){if(!e)return;for(var t=0;t<e.length;t++)j(e[t].id)}(n),function(e,t){if(!t)return;n=e,r=t.id,feelwithme.highlightIdToMarkId[r]=n,feelwithme.markIdTohighlightId[n]=r;var n,r}(e,t)}function U(){var e=window.getSelection(),t=D(e,!1);return!(!e.isCollapsed&&0!=t.length)}function q(e){e.startContainer==document.body.parentElement&&(e=function(){var e=function(e){for(var t=e.children,n=0;n<t.length;n++){var r=t[n];if(b(r))return r}return null}(document.body),t=document.createRange();return t.selectNode(e),t}());var t=I("block",[e.startContainer,e.endContainer]),n=function(e,t=document.body){var n="";if(!s(e.nodeName,document.nodeName)&&!s(e.nodeName,document.body.parentNode.nodeName)){for(;null!=e&&e.nodeName!=t.nodeName;){var r=e.getAttribute("id");if(r)return"//"+e.nodeName+'[@id="'+r+'"]'+n;var o=M(e)+1;n="/"+e.nodeName+"["+o+"]"+n,e=e.parentNode}return n}}(t),o=r.createRange();return o.setStartAndEnd(e.startContainer,e.startOffset,e.endContainer,e.endOffset),function(e,t){if(!e)return null;return{containerXPath:t,start:e.start,end:e.end}}(o.getBookmark(t),n)}function X(e,t,n=!0,r=!1){t||(t=e.startContainer==document.body.parentElement?"":e.toString());var o={version:"composit/v1"};return o.documentOffset=e.getBoundingClientRect().y,o.xpathLocation=q(e),r&&null!=feelwithme.operationLocation.text?o.textLocation=feelwithme.operationLocation.text:o.textLocation=A(e,0,n),o}function $(e){var t=rangyHighlighter.getHighlightForElement(e);feelwithme.lastHighlight=t,feelwithme.thisHighlight=e;var n=V(t.id),r=t.getRange().nativeRange,i=W(r.cloneContents(),!1),a=P(r,0,!1);!function(e,t,n,r,i){o.onClickMark(e,t,n,r,i)}(n,e.getBoundingClientRect(),i,a,t.hasNote)}feelwithme.init,feelwithme.readingLocate={range:null,scrollY:null,reportScrollY:null},feelwithme.viewInfo={docHeight:0,scrollY:null},feelwithme.bodyVisibleText=null,feelwithme.tailMark=null,feelwithme.readerView={},feelwithme.loadMark={},feelwithme.loadMark.pageSize=50,feelwithme.loadMark.done=!1,feelwithme.resizeObserver,feelwithme.anchor={},feelwithme.anchor.list=[],feelwithme.anchor.lastIndex=0,feelwithme.viewPort={},feelwithme.markClassList=["mark-A","mark-B","mark-C","mark-D","mark-E"],feelwithme.screenRotation={},feelwithme.operationLocation={},feelwithme.operationLocation.text={},p((function(){feelwithme.bodyVisibleText=document.body.innerText})),m((function(){logger.info("whenDocumentDependensHasLoaded executing");var e=feelwithme.bodyVisibleText||"",t=document.body.innerText;t.length!=e.length?feelwithme.bodyVisibleText=t:logger.info("body text does no change ..."),o.loadAnchorsRequest()})),readerInput.delegateImpl.onScroll=function(e,t){logger.debug("receive x ",e," , y  : ",t),v(t),H(t),null!=t&&B(t)},readerInput.delegateImpl.gotoAnchor=function(e){var t=u(e);null!=t&&d(c(),t)},readerInput.delegateImpl.loadAnchorsResponse=function(e){var t=[];e.forEach((e=>{var n=u(e);null!=n&&t.push({anchor:e,y:n})})),0!=t.length&&(t.sort((function(e,t){return e.y-t.y})),feelwithme.anchor.list=t.map((e=>e.anchor)),B(R()))},readerInput.delegateImpl.changeFontSize=function(e){var t=feelwithme.readingLocate.range,n=R();null==t&&null!=n&&C(t=y(n)),readerInput.setFontSize(e)},readerInput.delegateImpl.unfreezeReadingRange=function(){C(null)},readerInput.delegateImpl.changeMode=function(e){var t=document.documentElement,n="darkMode";if(e){if(t.classList.contains(n))return;t.classList.add(n)}else t.classList.remove(n)},readerInput.delegateImpl.handleScreenRotationBefore=function(e){var t=feelwithme.readingLocate.range;(function(e,t){if(null==e||null==t)return!1;var n=e.getBoundingClientRect(),r=parseInt(n.top),o=parseInt(n.bottom);return r<=(t=parseInt(t))&&t<o})(t,e=R())||C(t=y(e),"rotation , docHeight : "+c()+" , scrollY "+e)},readerInput.delegateImpl.reportTrueReadingProgressInfo=function(e){e=Number(e.toFixed(0));var t=Math.floor(c()),n=0;0==t&&(n=0),e>t&&(e=t),n=Math.floor(e)/Math.floor(t),o.onReportTrueReadingProgressInfo(n)},m((function(){var e;L(function(e,t,n){var r,o,i,a=null,s=0;n||(n={});var l=function(){s=!1===n.leading?0:Date.now(),a=null,i=e.apply(r,o),a||(r=o=null)};return function(){var c=Date.now(),d=t();s||!1!==n.leading||(s=c);var u=d-(c-s);return r=this,o=arguments,u<=0||u>d?(a&&(clearTimeout(a),a=null),s=c,i=e.apply(r,o),a||(r=o=null)):a||!1===n.trailing||(a=setTimeout(l,u)),i}}(g,(e=0,function(){var t=10;return e<=200?e+=t=20:e<=500?e+=t=200:t=200,t}),{leading:!1}))})),logger.debug("basic.js load success"),feelwithme.highlightIdToMarkId={},feelwithme.markIdTohighlightId={},readerInput.delegateImpl.mark=function(e,t){if(logger.debug("markId : ",e," markClass : ",t),U())!function(e){if(null!=feelwithme.lastHighlight){var t=rangyHighlighter.classAppliers[e];if(null!=t){feelwithme.lastHighlight.changeClassApplier(t);var n=V(feelwithme.lastHighlight.id);n&&o.onMarkClassChange(n,e)}}}(t);else{var n=F(e,t,!1);o.onMarkCreated(n.markId,n.markClass,n.removeMarkIds,n.percentRate,n.location,n.text,n.isNoting)}},readerInput.delegateImpl.addNote=function(e,t){if(U()){var n=feelwithme.lastHighlight;return n.hasNote||(n.hasNote=!0),{markId:e}}return{markId:e,newMark:F(e,t,!0)}},readerInput.delegateImpl.markNote=function(e){U()&&feelwithme.lastHighlight&&(feelwithme.lastHighlight.hasNote=e)},readerInput.delegateImpl.loadMarks=function(e){logger.debug("load marks number : ",e.length,"marks : ",JSON.stringify(e.map((e=>e.percentRate))));var t=null,n=0;e.forEach((e=>{if(null==(r=e.markId,feelwithme.markIdTohighlightId[r])){var r,o=h(e.location.xpathLocation);if(null!=o){var i=o.nativeRange.getBoundingClientRect().y;i>n&&(t=e,n=i);var a=rangyHighlighter.highlightRanges(e.style,[o]);a.forEach((t=>{t.hasNote=0!=(1&e.noteFlag)})),Y(e.markId,a[0],[])}}else logger.debug("mark has been highlight , skip ")})),null!=t&&(feelwithme.tailMark=t),e.length>=feelwithme.loadMark.pageSize?H():feelwithme.loadMark.done=!0},readerInput.delegateImpl.deleteMark=function(){null!=feelwithme.lastHighlight&&feelwithme.lastHighlight.unapply()},new function(e,t){var n=this;n.startEvent=null,n.endEvent=null,document.addEventListener("touchstart",(function(e){n.startEvent=e})),document.addEventListener("touchend",(function(t){n.endEvent=t;const r=window.getSelection();if(0==r.rangeCount)return;const o=r.getRangeAt(0).getBoundingClientRect(),i=z(o,n.startEvent.pageX,n.startEvent.pageY)||z(o,t.pageX,t.pageY);!r.isCollapsed&&i&&e(t)})),document.addEventListener("click",(function(e){(function(e){for(;null!=e&&e!=document.body;){if("a"==e.nodeName.toLowerCase())return!0;e=e.parentNode}return!1})(e.target)||("img"==e.target.tagName.toLowerCase()&&e.target.src.length>0?o.onClickImage(e.target.src):t(e))}))}((function(e){var t=window.getSelection();if(!(null==t||0==t.rangeCount||t.isCollapsed||t.toString().trim().length<1)){var n=t.getRangeAt(0).getBoundingClientRect(),r=t.toString(),i=P(t.getRangeAt(0),0,!0);o.onNewSelectionExist(n,r,i)}}),(function(e){var t={x:e.pageX,y:e.pageY};o.onClickNonSelectionArea(t)})),logger.debug("mark.js load success"),feelwithme.classAppliers={},feelwithme.lastHighlight={},readerInput.delegateImpl.reportReadingProgress=function(e){logger.debug("reportReadingProgress : ",e);var t=X(y(e),null,!1);t.documentOffset=e,o.onSaveProgress(t)},p((function(){r.init(),window.rangyHighlighter=r.createHighlighter(),feelwithme.markClassList.forEach((e=>{return rangyHighlighter.addClassApplier((t=e,n=r.createClassApplier(t,{ignoreWhiteSpace:!0,elementProperties:{onclick:function(e){e.stopPropagation(),$(this)}}}),feelwithme.classAppliers[t]=n,n));var t,n}))}))},844:function(e,t,n){var r,o,a;o=[n(946)],r=function(e){return e.createModule("ClassApplier",["WrappedSelection"],(function(e,t){var n=e.dom,r=n.DomPosition,o=n.arrayContains,a=e.util,s=a.forEach,l="span",c=a.isHostMethod(document,"createElementNS");function d(e,t){for(var n in e)if(e.hasOwnProperty(n)&&!1===t(n,e[n]))return!1;return!0}function u(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function f(e,t){return!!e&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e)}function h(e,t){return"object"==typeof e.classList?e.classList.contains(t):f("string"==typeof e.className?e.className:e.getAttribute("class"),t)}function g(e,t){if("object"==typeof e.classList)e.classList.add(t);else{var n="string"==typeof e.className,r=n?e.className:e.getAttribute("class");r?f(r,t)||(r+=" "+t):r=t,n?e.className=r:e.setAttribute("class",r)}}var p=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){if("object"==typeof t.classList)t.classList.remove(n);else{var r="string"==typeof t.className,o=r?t.className:t.getAttribute("class");o=o.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e),r?t.className=o:t.setAttribute("class",o)}}}();function m(e){return"string"==typeof e.className?e.className:e.getAttribute("class")}function v(e){return e&&e.split(/\s+/).sort().join(" ")}function R(e){return v(m(e))}function C(e,t){return R(e)==R(t)}function N(e,t){for(var n=t.split(/\s+/),r=0,o=n.length;r<o;++r)if(!h(e,u(n[r])))return!1;return!0}function E(e){var t=e.parentNode;return t&&1==t.nodeType&&!/^(textarea|style|script|select|iframe)$/i.test(t.nodeName)}function y(e,t,n,r,o){var i=e.node,a=e.offset,s=i,l=a;i==r&&a>o&&++l,i!=t||a!=n&&a!=n+1||(s=r,l+=o-n),i==t&&a>n+1&&--l,e.node=s,e.offset=l}function w(e,t,n){e.node==t&&e.offset>n&&--e.offset}function S(e,t,r,o){-1==r&&(r=t.childNodes.length);var i=e.parentNode,a=n.getNodeIndex(e);s(o,(function(e){y(e,i,a,t,r)})),t.childNodes.length==r?t.appendChild(e):t.insertBefore(e,t.childNodes[r])}function T(e,t){var r=e.parentNode,o=n.getNodeIndex(e);s(t,(function(e){w(e,r,o)})),n.removeNode(e)}function A(e,t,n,r,o){for(var i,a=[];i=e.firstChild;)S(i,t,n++,o),a.push(i);return r&&T(e,o),a}function x(e,t){return A(e,e.parentNode,n.getNodeIndex(e),!0,t)}function b(e,t){var n=e.cloneRange();n.selectNodeContents(t);var r=n.intersection(e);return""!=(r?r.toString():"")}function O(e){for(var t,n=e.getNodes([3]),r=0;(t=n[r])&&!b(e,t);)++r;for(var o=n.length-1;(t=n[o])&&!b(e,t);)--o;return n.slice(r,o+1)}function I(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,r,o,i=0,a=e.attributes.length;i<a;++i)if("class"!=(o=(n=e.attributes[i]).name)){if(null===n!=(null===(r=t.attributes.getNamedItem(o))))return!1;if(n.specified!=r.specified)return!1;if(n.specified&&n.nodeValue!==r.nodeValue)return!1}return!0}function M(e,t){for(var n,r=0,i=e.attributes.length;r<i;++r)if(n=e.attributes[r].name,(!t||!o(t,n))&&e.attributes[r].specified&&"class"!=n)return!0;return!1}var k=n.getComputedStyleProperty,D="boolean"==typeof document.createElement("div").isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return!(!e||1!=e.nodeType||"false"==e.contentEditable)&&("true"==e.contentEditable||D(e.parentNode))};function _(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||D(e)&&!D(e.parentNode))}function P(e){return(D(e)||1!=e.nodeType&&D(e.parentNode))&&!_(e)}var H=/^inline(-block|-table)?$/i;function L(e){return e&&1==e.nodeType&&!H.test(k(e,"display"))}var B=/[^\r\n\t\f \u200B]/;function W(e){if(0==e.data.length)return!0;if(B.test(e.data))return!1;switch(k(e.parentNode,"whiteSpace")){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return L(e.previousSibling)||L(e.nextSibling)}function z(e){var t,n,o=[];for(t=0;n=e[t++];)o.push(new r(n.startContainer,n.startOffset),new r(n.endContainer,n.endOffset));return o}function F(e,t){for(var n,r,o,i=0,a=e.length;i<a;++i)n=e[i],r=t[2*i],o=t[2*i+1],n.setStartAndEnd(r.node,r.offset,o.node,o.offset)}function V(e,t){return n.isCharacterDataNode(e)?0==t?!!e.previousSibling:t!=e.length||!!e.nextSibling:t>0&&t<e.childNodes.length}function j(e,r,o,i){var a,s,l=0==o;if(n.isAncestorOf(r,e))return e;if(n.isCharacterDataNode(r)){var c=n.getNodeIndex(r);if(0==o)o=c;else{if(o!=r.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+o+" in "+r.data);o=c+1}r=r.parentNode}if(V(r,o)){a=r.cloneNode(!1),s=r.parentNode,a.id&&a.removeAttribute("id");for(var d,u=0;d=r.childNodes[o];)S(d,a,u++,i);return S(a,s,n.getNodeIndex(r)+1,i),r==e?a:j(e,s,n.getNodeIndex(a),i)}if(e!=r){a=r.parentNode;var f=n.getNodeIndex(r);return l||f++,j(e,a,f,i)}return e}function Y(e,t){return e.namespaceURI==t.namespaceURI&&e.tagName.toLowerCase()==t.tagName.toLowerCase()&&C(e,t)&&I(e,t)&&"inline"==k(e,"display")&&"inline"==k(t,"display")}function U(e){var t=e?"nextSibling":"previousSibling";return function(n,r){var o=n.parentNode,i=n[t];if(i){if(i&&3==i.nodeType)return i}else if(r&&(i=o[t])&&1==i.nodeType&&Y(o,i)){var a=i[e?"firstChild":"lastChild"];if(a&&3==a.nodeType)return a}return null}}var q=U(!1),X=U(!0);function $(e){this.isElementMerge=1==e.nodeType,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}$.prototype={doMerge:function(e){var t=this.textNodes,r=t[0];if(t.length>1){var o,i=n.getNodeIndex(r),a=[],l=0;s(t,(function(t,c){o=t.parentNode,c>0&&(o.removeChild(t),o.hasChildNodes()||n.removeNode(o),e&&s(e,(function(e){e.node==t&&(e.node=r,e.offset+=l),e.node==o&&e.offset>i&&(--e.offset,e.offset==i+1&&c<len-1&&(e.node=r,e.offset=l))}))),a[c]=t.data,l+=t.data.length})),r.data=a.join("")}return r.data},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){var e=[];return s(this.textNodes,(function(t,n){e[n]="'"+t.data+"'"})),"[Merge("+e.join(",")+")]"}};var G=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],Q={};function J(e,t,n){var r,o,i,a,s=this;s.cssClass=s.className=e;var l=null,c={};if("object"==typeof t&&null!==t){for(void 0!==t.elementTagName&&(t.elementTagName=t.elementTagName.toLowerCase()),n=t.tagNames,l=t.elementProperties,c=t.elementAttributes,o=0;a=G[o++];)t.hasOwnProperty(a)&&(s[a]=t[a]);r=t.normalize}else r=t;s.normalize=void 0===r||r,s.attrExceptions=[];var f=document.createElement(s.elementTagName);s.elementProperties=s.copyPropertiesToElement(l,f,!0),d(c,(function(e,t){s.attrExceptions.push(e),c[e]=""+t})),s.elementAttributes=c,s.elementSortedClassName=s.elementProperties.hasOwnProperty("className")?v(s.elementProperties.className+" "+e):e,s.applyToAnyTagName=!1;var h=typeof n;if("string"==h)"*"==n?s.applyToAnyTagName=!0:s.tagNames=u(n.toLowerCase()).split(/\s*,\s*/);else if("object"==h&&"number"==typeof n.length)for(s.tagNames=[],o=0,i=n.length;o<i;++o)"*"==n[o]?s.applyToAnyTagName=!0:s.tagNames.push(n[o].toLowerCase());else s.tagNames=[s.elementTagName]}function Z(e,t,n){return new J(e,t,n)}J.prototype={elementTagName:l,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var r,o,i,a,s,l,c={};for(var d in e)if(e.hasOwnProperty(d))if(a=e[d],s=t[d],"className"==d)g(t,a),g(t,this.className),t[d]=v(t[d]),n&&(c[d]=a);else if("style"==d){for(r in o=s,n&&(c[d]=i={}),e[d])e[d].hasOwnProperty(r)&&(o[r]=a[r],n&&(i[r]=o[r]));this.attrExceptions.push(d)}else t[d]=a,n&&(c[d]=t[d],l=Q.hasOwnProperty(d)?Q[d]:d,this.attrExceptions.push(l));return n?c:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&!/^class(?:Name)?$/i.test(n)&&t.setAttribute(n,e[n])},appliesToElement:function(e){return o(this.tagNames,e.tagName.toLowerCase())},getEmptyElements:function(e){var t=this;return e.getNodes([1],(function(e){return t.appliesToElement(e)&&!e.hasChildNodes()}))},hasClass:function(e){return 1==e.nodeType&&(this.applyToAnyTagName||this.appliesToElement(e))&&h(e,this.className)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||P(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&W(e)},postApply:function(e,t,n,r){var o,a,l=e[0],c=e[e.length-1],d=[],u=l,f=c,h=0,g=c.length;s(e,(function(e){(a=q(e,!r))?(o||(o=new $(a),d.push(o)),o.textNodes.push(e),e===l&&(u=o.textNodes[0],h=u.length),e===c&&(f=o.textNodes[0],g=o.getLength())):o=null}));var p=X(c,!r);if(p&&(o||(o=new $(c),d.push(o)),o.textNodes.push(p)),d.length){for(i=0,len=d.length;i<len;++i)d[i].doMerge(n);t.setStartAndEnd(u,h,f,g)}},createContainer:function(e){var t=n.getDocument(e),r=c&&!n.isHtmlNamespace(e)&&e.namespaceURI?t.createElementNS(e.namespaceURI,this.elementTagName):t.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,r,!1),this.copyAttributesToElement(this.elementAttributes,r),g(r,this.className),this.onElementCreate&&this.onElementCreate(r,this),r},elementHasProperties:function(e,t){var n=this;return d(t,(function(t,r){if("className"==t)return N(e,r);if("object"==typeof r){if(!n.elementHasProperties(e[t],r))return!1}else if(e[t]!==r)return!1}))},elementHasAttributes:function(e,t){return d(t,(function(t,n){if(e.getAttribute(t)!==n)return!1}))},applyToTextNode:function(e,t){if(E(e)){var n=e.parentNode;if(1==n.childNodes.length&&this.useExistingElements&&this.appliesToElement(n)&&this.elementHasProperties(n,this.elementProperties)&&this.elementHasAttributes(n,this.elementAttributes))g(n,this.className);else{var r=e.parentNode,o=this.createContainer(r);r.insertBefore(o,e),o.appendChild(e)}}},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&R(e)==this.elementSortedClassName&&this.elementHasProperties(e,this.elementProperties)&&!M(e,this.attrExceptions)&&this.elementHasAttributes(e,this.elementAttributes)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return 1==e.nodeType&&this.isRemovable(e)&&(0==t||1==t&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){var t=this,n=e.getNodes([1],(function(e){return t.isEmptyContainer(e)})),r=[e],o=z(r);s(n,(function(e){T(e,o)})),F(r,o)},undoToTextNode:function(e,t,n,r){if(!t.containsNode(n)){var o=t.cloneRange();o.selectNode(n),o.isPointInRange(t.endContainer,t.endOffset)&&(j(n,t.endContainer,t.endOffset,r),t.setEndAfter(n)),o.isPointInRange(t.startContainer,t.startOffset)&&(n=j(n,t.startContainer,t.startOffset,r))}this.isRemovable(n)?x(n,r):p(n,this.className)},splitAncestorWithClass:function(e,t,n){var r=this.getSelfOrAncestorWithClass(e);r&&j(r,e,t,n)},undoToAncestor:function(e,t){this.isRemovable(e)?x(e,t):p(e,this.className)},applyToRange:function(e,t){var n=this,r=z((t=t||[])||[]);e.splitBoundariesPreservingPositions(r),n.removeEmptyElements&&n.removeEmptyContainers(e);var o=O(e);if(o.length){s(o,(function(e){n.isIgnorableWhiteSpaceNode(e)||n.getSelfOrAncestorWithClass(e)||!n.isModifiable(e)||n.applyToTextNode(e,r)}));var i=o[o.length-1];e.setStartAndEnd(o[0],0,i,i.length),n.normalize&&n.postApply(o,e,r,!1),F(t,r)}var a=n.getEmptyElements(e);s(a,(function(e){g(e,n.className)}))},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){var n=this,r=z(t=t||[]);e.splitBoundariesPreservingPositions(r),n.removeEmptyElements&&n.removeEmptyContainers(e,r);var o,i,a=O(e),l=a[a.length-1];if(a.length){n.splitAncestorWithClass(e.endContainer,e.endOffset,r),n.splitAncestorWithClass(e.startContainer,e.startOffset,r);for(var c=0,d=a.length;c<d;++c)o=a[c],(i=n.getSelfOrAncestorWithClass(o))&&n.isModifiable(o)&&n.undoToAncestor(i,r);e.setStartAndEnd(a[0],0,l,l.length),n.normalize&&n.postApply(a,e,r,!0),F(t,r)}var u=n.getEmptyElements(e);s(u,(function(e){p(e,n.className)}))},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),r=e.getSelection(t).getAllRanges();this.undoToRanges(r),n.setRanges(r)},isAppliedToRange:function(e){if(e.collapsed||""==e.toString())return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n,r=0;n=t[r++];)if(!this.isIgnorableWhiteSpaceNode(n)&&b(e,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(0==t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],(function(e){var r=n.getSelfOrAncestorWithClass(e);r&&!o(t,r)&&t.push(r)})),t},detach:function(){}},J.util={hasClass:h,addClass:g,removeClass:p,getClass:m,hasSameClasses:C,hasAllClasses:N,replaceWithOwnChildren:x,elementsHaveSameNonClassAttributes:I,elementHasNonClassAttributes:M,splitNodeAt:j,isEditableElement:D,isEditingHost:_,isEditable:P},e.CssClassApplier=e.ClassApplier=J,e.createClassApplier=Z,a.createAliasForDeprecatedMethod(e,"createCssClassApplier","createClassApplier",t)})),e},void 0===(a="function"==typeof r?r.apply(t,o):r)||(e.exports=a)},946:function(e,t,n){var r,o;r=function(){var e="object",t="function",n="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],o=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],i=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],a=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function s(n,r){var o=typeof n[r];return o==t||!(o!=e||!n[r])||"unknown"==o}function l(t,n){return!(typeof t[n]!=e||!t[n])}function c(e,t){return typeof e[t]!=n}function d(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}var u=d(s),f=d(l),h=d(c);function g(e){return e&&u(e,a)&&h(e,i)}function p(e){return l(e,"body")?e.body:e.getElementsByTagName("body")[0]}var m,v,R={},C=typeof window!=n&&typeof document!=n,N={isHostMethod:s,isHostObject:l,isHostProperty:c,areHostMethods:u,areHostObjects:f,areHostProperties:h,isTextRange:g,getBody:p,forEach:[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)t(e[n],n)}},E={version:"1.3.1-dev",initialized:!1,isBrowser:C,supported:!0,util:N,features:{},modules:R,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==n||rangyAutoInitialize}};function y(e){typeof console!=n&&s(console,"log")&&console.log(e)}function w(e,t){C&&t?alert(e):y(e)}function S(e){E.initialized=!0,E.supported=!1,w("Rangy is not supported in this environment. Reason: "+e,E.config.alertOnFail)}function T(e){w("Rangy warning: "+e,E.config.alertOnWarn)}E.fail=S,E.warn=T,{}.hasOwnProperty?(N.extend=m=function(e,t,n){var r,o;for(var i in t)t.hasOwnProperty(i)&&(r=e[i],o=t[i],n&&null!==r&&"object"==typeof r&&null!==o&&"object"==typeof o&&m(r,o,!0),e[i]=o);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},N.createOptions=function(e,t){var n={};return m(n,t),e&&m(n,e),n}):S("hasOwnProperty not supported"),C||S("Rangy can only run in a browser"),function(){var e;if(C){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(e){}}e||(e=function(e){for(var t=[],n=0,r=e.length;n<r;++n)t[n]=e[n];return t}),N.toArray=e}(),C&&(s(document,"addEventListener")?v=function(e,t,n){e.addEventListener(t,n,!1)}:s(document,"attachEvent")?v=function(e,t,n){e.attachEvent("on"+t,n)}:S("Document does not have required addEventListener or attachEvent method"),N.addListener=v);var A=[];function x(e){return e.message||e.description||String(e)}function b(){if(C&&!E.initialized){var e,t=!1,n=!1;s(document,"createRange")&&(e=document.createRange(),u(e,o)&&h(e,r)&&(t=!0));var i=p(document);if(i&&"body"==i.nodeName.toLowerCase())if(i&&s(i,"createTextRange")&&g(e=i.createTextRange())&&(n=!0),t||n){var a;for(var l in E.initialized=!0,E.features={implementsDomRange:t,implementsTextRange:n},R)(a=R[l])instanceof D&&a.init(a,E);for(var c=0,d=A.length;c<d;++c)try{A[c](E)}catch(e){y("Rangy init listener threw an exception. Continuing. Detail: "+x(e))}}else S("Neither Range nor TextRange are available");else S("No body element found")}}function O(e,t,n){n&&(e+=" in module "+n.name),E.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function I(e,t,n,r){e[t]=function(){return O(t,n,r),e[n].apply(e,N.toArray(arguments))}}N.deprecationNotice=O,N.createAliasForDeprecatedMethod=I,E.init=b,E.addInitListener=function(e){E.initialized?e(E):A.push(e)};var M=[];function k(e){e=e||window,b();for(var t=0,n=M.length;t<n;++t)M[t](e)}function D(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function _(e,t,n){var r=new D(e,t,(function(t){if(!t.initialized){t.initialized=!0;try{n(E,t),t.supported=!0}catch(t){y("Module '"+e+"' failed to load: "+x(t)),t.stack&&y(t.stack)}}}));return R[e]=r,r}function P(){}function H(){}E.addShimListener=function(e){M.push(e)},C&&(E.shim=E.createMissingNativeApi=k,I(E,"createMissingNativeApi","shim")),D.prototype={init:function(){for(var e,t,n=this.dependencies||[],r=0,o=n.length;r<o;++r){if(t=n[r],!((e=R[t])&&e instanceof D))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){E.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){E.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},E.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var r=_(e,n,t);E.initialized&&E.supported&&r.init()},E.createCoreModule=function(e,t,n){_(e,t,n)},E.RangePrototype=P,E.rangePrototype=new P,E.selectionPrototype=new H,E.createCoreModule("DomUtil",[],(function(e,t){var n="undefined",r=e.util,o=r.getBody;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var i=document.createElement("div");r.areHostMethods(i,["insertBefore","appendChild","cloneNode"]||0)||t.fail("Incomplete Element implementation"),r.isHostProperty(i,"innerHTML")||t.fail("Element is missing innerHTML property");var a=document.createTextNode("test");r.areHostMethods(a,["splitText","deleteData","insertData","appendData","cloneNode"]||0)||t.fail("Incomplete Text Node implementation");var s=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};function l(e){var t;return typeof e.namespaceURI==n||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function c(e){var t=e.parentNode;return 1==t.nodeType?t:null}function d(e){for(var t=0;e=e.previousSibling;)++t;return t}function u(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function f(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(s(r,n))return n;return null}function h(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function g(e,t){return h(e,t,!0)}function p(e,t,n){for(var r,o=n?e:e.parentNode;o;){if((r=o.parentNode)===t)return o;o=r}return null}function m(e){var t=e.nodeType;return 3==t||4==t||8==t}function v(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function R(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function C(e,t,n){var r=e.cloneNode(!1);if(r.deleteData(0,t),e.deleteData(t,e.length-t),R(r,e),n)for(var o,i=0;o=n[i++];)o.node==e&&o.offset>t?(o.node=r,o.offset-=t):o.node==e.parentNode&&o.offset>d(e)&&++o.offset;return r}function N(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return N(e.parentNode);throw t.createError("getDocument: no document found for node")}function E(e){var r=N(e);if(typeof r.defaultView!=n)return r.defaultView;if(typeof r.parentWindow!=n)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function y(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function w(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function S(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}function T(e,t,n){var o;if(e?r.isHostProperty(e,"nodeType")?o=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?y(e):N(e):S(e)&&(o=e.document):o=document,!o)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return o}function A(e){for(var t;t=e.parentNode;)e=t;return e}function x(e,n,r,o){var i,a,s,l,c;if(e==r)return n===o?0:n<o?-1:1;if(i=p(r,e,!0))return n<=d(i)?-1:1;if(i=p(e,r,!0))return d(i)<o?-1:1;if(!(a=f(e,r)))throw new Error("comparePoints error: nodes have no common ancestor");if((s=e===a?a:p(e,a,!0))===(l=r===a?a:p(r,a,!0)))throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(c=a.firstChild;c;){if(c===s)return-1;if(c===l)return 1;c=c.nextSibling}}var b,O=!1;function I(e){try{return e.parentNode,!1}catch(e){return!0}}function M(e){if(!e)return"[No node]";if(O&&I(e))return"[Broken node]";if(m(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+d(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function k(e){for(var t,n=N(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function D(e,t,n){var r=o(e),i=e.createElement("div");i.contentEditable=""+!!n,t&&(i.innerHTML=t);var a=r.firstChild;return a?r.insertBefore(i,a):r.appendChild(i),i}function _(e){return e.parentNode.removeChild(e)}function P(e){this.root=e,this._next=e}function H(e){return new P(e)}function L(e,t){this.node=e,this.offset=t}function B(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",O=I(n),e.features.crashyTextNodes=O}(),typeof window.getComputedStyle!=n?b=function(e,t){return E(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=n?b=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),P.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},L.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+M(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},B.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},B.prototype.toString=function(){return this.message},e.dom={arrayContains:s,isHtmlNamespace:l,parentElement:c,getNodeIndex:d,getNodeLength:u,getCommonAncestor:f,isAncestorOf:h,isOrIsAncestorOf:g,getClosestAncestorIn:p,isCharacterDataNode:m,isTextOrCommentNode:v,insertAfter:R,splitDataNode:C,getDocument:N,getWindow:E,getIframeWindow:w,getIframeDocument:y,getBody:o,isWindow:S,getContentDocument:T,getRootContainer:A,comparePoints:x,isBrokenNode:I,inspectNode:M,getComputedStyleProperty:b,createTestElement:D,removeNode:_,fragmentFromNodeChildren:k,createIterator:H,DomPosition:L},e.DOMException=B})),E.createCoreModule("DomRange",["DomUtil"],(function(e,t){var n=e.dom,r=e.util,o=n.DomPosition,i=e.DOMException,a=n.isCharacterDataNode,s=n.getNodeIndex,l=n.isOrIsAncestorOf,c=n.getDocument,d=n.comparePoints,u=n.splitDataNode,f=n.getClosestAncestorIn,h=n.getNodeLength,g=n.arrayContains,p=n.getRootContainer,m=e.features.crashyTextNodes,v=n.removeNode;function R(e,t){return 3!=e.nodeType&&(l(e,t.startContainer)||l(e,t.endContainer))}function C(e){return e.document||c(e.startContainer)}function N(e){return p(e.startContainer)}function E(e){return new o(e.parentNode,s(e))}function y(e){return new o(e.parentNode,s(e)+1)}function w(e,t,r){var o=11==e.nodeType?e.firstChild:e;return a(t)?r==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,0==r?t:u(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),o}function S(e,t,n){if(G(e),G(t),C(t)!=C(e))throw new i("WRONG_DOCUMENT_ERR");var r=d(e.startContainer,e.startOffset,t.endContainer,t.endOffset),o=d(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&o>=0:r<0&&o>0}function T(e){for(var t,n,r,o=C(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(r=e.getSubtreeIterator(),n.appendChild(T(r)),r.detach()),10==n.nodeType)throw new i("HIERARCHY_REQUEST_ERR");o.appendChild(n)}return o}function A(e,t,r){var o,i,a,s;for(r=r||{stop:!1};a=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(a))return void(r.stop=!0);if(A(s=e.getSubtreeIterator(),t,r),s.detach(),r.stop)return}else for(o=n.createIterator(a);i=o.next();)if(!1===t(i))return void(r.stop=!0)}function x(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(x(t=e.getSubtreeIterator()),t.detach()):e.remove()}function b(e){for(var t,n,r=C(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(b(n)),n.detach()):e.remove(),10==t.nodeType)throw new i("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function O(e,t,n){var r,o=!(!t||!t.length),i=!!n;o&&(r=new RegExp("^("+t.join("|")+")$"));var s=[];return A(new M(e,!1),(function(t){if((!o||r.test(t.nodeType))&&(!i||n(t))){var l=e.startContainer;if(t!=l||!a(l)||e.startOffset!=l.length){var c=e.endContainer;t==c&&a(c)&&0==e.endOffset||s.push(t)}}})),s}function I(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function M(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&a(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||a(this.sc)?f(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||a(this.ec)?f(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}M.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,a(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!a(n)||n!==this.sc&&n!==this.ec?n.parentNode&&v(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return R(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new me(C(this.range));var t=this._current,n=t,r=0,o=t,i=h(t);l(t,this.sc)&&(n=this.sc,r=this.so),l(t,this.ec)&&(o=this.ec,i=this.eo),pe(e,n,r,o,i)}return new M(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var k=[1,3,4,5,7,8,10],D=[2,9,11],_=[5,6,10,12],P=[1,3,4,5,7,8,10,11],H=[1,3,4,5,7,8];function L(e){return function(t,n){for(var r,o=n?t:t.parentNode;o;){if(r=o.nodeType,g(e,r))return o;o=o.parentNode}return null}}var B=L([9,11]),W=L(_),z=L([6,10,12]);function F(e,t){if(z(e,t))throw new i("INVALID_NODE_TYPE_ERR")}function V(e,t){if(!g(t,e.nodeType))throw new i("INVALID_NODE_TYPE_ERR")}function j(e,t){if(t<0||t>(a(e)?e.length:e.childNodes.length))throw new i("INDEX_SIZE_ERR")}function Y(e,t){if(B(e,!0)!==B(t,!0))throw new i("WRONG_DOCUMENT_ERR")}function U(e){if(W(e,!0))throw new i("NO_MODIFICATION_ALLOWED_ERR")}function q(e,t){if(!e)throw new i(t)}function X(e,t){return t<=(a(e)?e.length:e.childNodes.length)}function $(e){return!!e.startContainer&&!!e.endContainer&&!(m&&(n.isBrokenNode(e.startContainer)||n.isBrokenNode(e.endContainer)))&&p(e.startContainer)==p(e.endContainer)&&X(e.startContainer,e.startOffset)&&X(e.endContainer,e.endOffset)}function G(e){if(!$(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var Q=document.createElement("style"),J=!1;try{Q.innerHTML="<b>x</b>",J=3==Q.firstChild.nodeType}catch(e){}e.features.htmlParsingConforms=J;var Z=J?function(e){var t=this.startContainer,r=c(t);if(!t)throw new i("INVALID_STATE_ERR");var o=null;return 1==t.nodeType?o=t:a(t)&&(o=n.parentElement(t)),(o=null===o||"HTML"==o.nodeName&&n.isHtmlNamespace(c(o).documentElement)&&n.isHtmlNamespace(o)?r.createElement("body"):o.cloneNode(!1)).innerHTML=e,n.fragmentFromNodeChildren(o)}:function(e){var t=C(this).createElement("body");return t.innerHTML=e,n.fragmentFromNodeChildren(t)};function K(e,t){G(e);var n=e.startContainer,r=e.startOffset,o=e.endContainer,i=e.endOffset,l=n===o;a(o)&&i>0&&i<o.length&&u(o,i,t),a(n)&&r>0&&r<n.length&&(n=u(n,r,t),l?(i-=r,o=n):o==n.parentNode&&i>=s(n)&&i++,r=0),e.setStartAndEnd(n,r,o,i)}function ee(e){G(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}var te=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ne=0,re=1,oe=2,ie=3,ae=0,se=1,le=2,ce=3;function de(e){e.START_TO_START=ne,e.START_TO_END=re,e.END_TO_END=oe,e.END_TO_START=ie,e.NODE_BEFORE=ae,e.NODE_AFTER=se,e.NODE_BEFORE_AND_AFTER=le,e.NODE_INSIDE=ce}function ue(e){de(e),de(e.prototype)}function fe(e,t){return function(){G(this);var n,r=this.startContainer,o=this.startOffset,i=this.commonAncestorContainer,a=new M(this,!0);r!==i&&(r=(n=y(f(r,i,!0))).node,o=n.offset),A(a,U),a.reset();var s=e(a);return a.detach(),t(this,r,o,r,o),s}}function he(t,n){function o(e,t){return function(n){V(n,k),V(p(n),D);var r=(e?E:y)(n);(t?i:l)(this,r.node,r.offset)}}function i(e,t,r){var o=e.endContainer,i=e.endOffset;t===e.startContainer&&r===e.startOffset||(p(t)==p(o)&&1!=d(t,r,o,i)||(o=t,i=r),n(e,t,r,o,i))}function l(e,t,r){var o=e.startContainer,i=e.startOffset;t===e.endContainer&&r===e.endOffset||(p(t)==p(o)&&-1!=d(t,r,o,i)||(o=t,i=r),n(e,o,i,t,r))}var c=function(){};c.prototype=e.rangePrototype,t.prototype=new c,r.extend(t.prototype,{setStart:function(e,t){F(e,!0),j(e,t),i(this,e,t)},setEnd:function(e,t){F(e,!0),j(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],r=e[1],o=t,i=r;switch(e.length){case 3:i=e[2];break;case 4:o=e[2],i=e[3]}n(this,t,r,o,i)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(e){G(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){F(e,!0),n(this,e,0,e,h(e))},selectNode:function(e){F(e,!1),V(e,k);var t=E(e),r=y(e);n(this,t.node,t.offset,r.node,r.offset)},extractContents:fe(b,n),deleteContents:fe(x,n),canSurroundContents:function(){G(this),U(this.startContainer),U(this.endContainer);var e=new M(this,!0),t=e._first&&R(e._first,this)||e._last&&R(e._last,this);return e.detach(),!t},splitBoundaries:function(){K(this)},splitBoundariesPreservingPositions:function(e){K(this,e)},normalizeBoundaries:function(){G(this);var e,t=this.startContainer,r=this.startOffset,o=this.endContainer,i=this.endOffset,l=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(o=e,i=e.length,e.appendData(t.data),v(t))},c=function(e){var n=e.previousSibling;if(n&&n.nodeType==e.nodeType){t=e;var a=e.length;if(r=n.length,e.insertData(0,n.data),v(n),t==o)i+=r,o=t;else if(o==e.parentNode){var l=s(e);i==l?(o=e,i=a):i>l&&i--}}},d=!0;if(a(o))i==o.length?l(o):0==i&&(e=o.previousSibling)&&e.nodeType==o.nodeType&&(i=e.length,t==o&&(d=!1),e.appendData(o.data),v(o),o=e);else{if(i>0){var u=o.childNodes[i-1];u&&a(u)&&l(u)}d=!this.collapsed}if(d){if(a(t))0==r?c(t):r==t.length&&(e=t.nextSibling)&&e.nodeType==t.nodeType&&(o==e&&(o=t,i+=t.length),t.appendData(e.data),v(e));else if(r<t.childNodes.length){var f=t.childNodes[r];f&&a(f)&&c(f)}}else t=o,r=i;n(this,t,r,o,i)},collapseToPoint:function(e,t){F(e,!0),j(e,t),this.setStartAndEnd(e,t)}}),ue(t)}function ge(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function pe(e,t,r,o,i){e.startContainer=t,e.startOffset=r,e.endContainer=o,e.endOffset=i,e.document=n.getDocument(t),ge(e)}function me(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,ge(this)}r.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){var n,r,o,i;G(this),Y(this.startContainer,t.startContainer);var a=e==ie||e==ne?"start":"end",s=e==re||e==ne?"start":"end";return n=this[a+"Container"],r=this[a+"Offset"],o=t[s+"Container"],i=t[s+"Offset"],d(n,r,o,i)},insertNode:function(e){if(G(this),V(e,P),U(this.startContainer),l(e,this.startContainer))throw new i("HIERARCHY_REQUEST_ERR");var t=w(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var e,t;if(G(this),this.collapsed)return C(this).createDocumentFragment();if(this.startContainer===this.endContainer&&a(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=C(this).createDocumentFragment()).appendChild(e),t;var n=new M(this,!0);return e=T(n),n.detach(),e},canSurroundContents:function(){G(this),U(this.startContainer),U(this.endContainer);var e=new M(this,!0),t=e._first&&R(e._first,this)||e._last&&R(e._last,this);return e.detach(),!t},surroundContents:function(e){if(V(e,H),!this.canSurroundContents())throw new i("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);w(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){G(this);for(var e,t=new me(C(this)),n=te.length;n--;)t[e=te[n]]=this[e];return t},toString:function(){G(this);var e=this.startContainer;if(e===this.endContainer&&a(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new M(this,!0);return A(n,(function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)})),n.detach(),t.join("")},compareNode:function(e){G(this);var t=e.parentNode,n=s(e);if(!t)throw new i("NOT_FOUND_ERR");var r=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return r<0?o>0?le:ae:o>0?se:ce},comparePoint:function(e,t){return G(this),q(e,"HIERARCHY_REQUEST_ERR"),Y(e,this.startContainer),d(e,t,this.startContainer,this.startOffset)<0?-1:d(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Z,toHtml:function(){return ee(this)},intersectsNode:function(e,t){if(G(this),p(e)!=N(this))return!1;var n=e.parentNode,r=s(e);if(!n)return!0;var o=d(n,r,this.endContainer,this.endOffset),i=d(n,r+1,this.startContainer,this.startOffset);return t?o<=0&&i>=0:o<0&&i>0},isPointInRange:function(e,t){return G(this),q(e,"HIERARCHY_REQUEST_ERR"),Y(e,this.startContainer),d(e,t,this.startContainer,this.startOffset)>=0&&d(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return S(this,e,!1)},intersectsOrTouchesRange:function(e){return S(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=d(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=d(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==d(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==d(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new i("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ce},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,h(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return G(this),O(this,e,t)},getDocument:function(){return C(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=C(this),o=e.createRange(r);t=t||n.getBody(r),o.selectNodeContents(t);var i=this.intersection(o),a=0,s=0;return i&&(o.setEnd(i.startContainer,i.startOffset),s=(a=o.toString().length)+i.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var r,o,i,a,s=[t],l=!1,c=!1;!c&&(r=s.pop());)if(3==r.nodeType)o=n+r.length,!l&&e.start>=n&&e.start<=o&&(this.setStart(r,e.start-n),l=!0),l&&e.end>=n&&e.end<=o&&(this.setEnd(r,e.end-n),c=!0),n=o;else for(i=(a=r.childNodes).length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return me.rangesEqual(this,e)},isValid:function(){return $(this)},inspect:function(){return I(this)},detach:function(){}}),he(me,pe),r.extend(me,{rangeProperties:te,RangeIterator:M,copyComparisonConstants:ue,createPrototypeRange:he,inspect:I,toHtml:ee,getRangeDocument:C,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=me})),E.createCoreModule("WrappedRange",["DomRange"],(function(e,t){var n,r,o=e.dom,i=e.util,a=o.DomPosition,s=e.DomRange,l=o.getBody,c=o.getContentDocument,d=o.isCharacterDataNode;if(e.features.implementsDomRange&&function(){var r,a,d=s.rangeProperties;function u(e){for(var t,n=d.length;n--;)e[t=d[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function f(e,t,n,r,o){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==r||e.endOffset!=o,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(r,o),e.setStart(t,n))}n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,u(this)},s.createPrototypeRange(n,f),(r=n.prototype).selectNode=function(e){this.nativeRange.selectNode(e),u(this)},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(e){this.nativeRange.surroundContents(e),u(this)},r.collapse=function(e){this.nativeRange.collapse(e),u(this)},r.cloneRange=function(){return new n(this.nativeRange.cloneRange())},r.refresh=function(){u(this)},r.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test");l(document).appendChild(h);var g=document.createRange();g.setStart(h,0),g.setEnd(h,0);try{g.setStart(h,1),r.setStart=function(e,t){this.nativeRange.setStart(e,t),u(this)},r.setEnd=function(e,t){this.nativeRange.setEnd(e,t),u(this)},a=function(e){return function(t){this.nativeRange[e](t),u(this)}}}catch(e){r.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}u(this)},r.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}u(this)},a=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}u(this)}}}r.setStartBefore=a("setStartBefore","setEndBefore"),r.setStartAfter=a("setStartAfter","setEndAfter"),r.setEndBefore=a("setEndBefore","setStartBefore"),r.setEndAfter=a("setEndAfter","setStartAfter"),r.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},g.selectNodeContents(h),g.setEnd(h,3);var p=document.createRange();p.selectNodeContents(h),p.setEnd(h,4),p.setStart(h,2),-1==g.compareBoundaryPoints(g.START_TO_END,p)&&1==g.compareBoundaryPoints(g.END_TO_START,p)?r.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:r.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var m=document.createElement("div");m.innerHTML="123";var v=m.firstChild,R=l(document);R.appendChild(m),g.setStart(v,1),g.setEnd(v,2),g.deleteContents(),"13"==v.data&&(r.deleteContents=function(){this.nativeRange.deleteContents(),u(this)},r.extractContents=function(){var e=this.nativeRange.extractContents();return u(this),e}),R.removeChild(m),R=null,i.isHostMethod(g,"createContextualFragment")&&(r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(h),r.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return(e=c(e,t,"createNativeRange")).createRange()}}(),e.features.implementsTextRange){var u=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();(n=e.duplicate()).collapse(!1);var i=n.parentElement(),a=r==i?r:o.getCommonAncestor(r,i);return a==t?a:o.getCommonAncestor(t,a)},f=function(e){return 0==e.compareEndPoints("StartToEnd",e)},h=function(e,t,n,r,i){var s=e.duplicate();s.collapse(n);var l=s.parentElement();if(o.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var c=new a(l.parentNode,o.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var u=o.getDocument(l).createElement("span");u.parentNode&&o.removeNode(u);for(var f,h,g,p,m,v=n?"StartToStart":"StartToEnd",R=i&&i.containerElement==l?i.nodeIndex:0,C=l.childNodes.length,N=C,E=N;E==C?l.appendChild(u):l.insertBefore(u,l.childNodes[E]),s.moveToElementText(u),0!=(f=s.compareEndPoints(v,e))&&R!=N;){if(-1==f){if(N==R+1)break;R=E}else N=N==R+1?R:E;E=Math.floor((R+N)/2),l.removeChild(u)}if(m=u.nextSibling,-1==f&&m&&d(m)){var y;if(s.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(m.data)){var w=s.duplicate(),S=w.text.replace(/\r\n/g,"\r").length;for(y=w.moveStart("character",S);-1==(f=w.compareEndPoints("StartToEnd",w));)y++,w.moveStart("character",1)}else y=s.text.length;p=new a(m,y)}else h=(r||!n)&&u.previousSibling,p=(g=(r||n)&&u.nextSibling)&&d(g)?new a(g,0):h&&d(h)?new a(h,h.data.length):new a(l,o.getNodeIndex(u));return o.removeNode(u),{boundaryPosition:p,nodeInfo:{nodeIndex:E,containerElement:l}}},g=function(e,t){var n,r,i,a,s=e.offset,c=o.getDocument(e.node),u=l(c).createTextRange(),f=d(e.node);return f?r=(n=e.node).parentNode:(n=s<(a=e.node.childNodes).length?a[s]:null,r=e.node),(i=c.createElement("span")).innerHTML="&#feff;",n?r.insertBefore(i,n):r.appendChild(i),u.moveToElementText(i),u.collapse(!t),r.removeChild(i),f&&u[t?"moveStart":"moveEnd"]("character",s),u};(r=function(e){this.textRange=e,this.refresh()}).prototype=new s(document),r.prototype.refresh=function(){var e,t,n,r=u(this.textRange);f(this.textRange)?t=e=h(this.textRange,r,!0,!0).boundaryPosition:(e=(n=h(this.textRange,r,!0,!1)).boundaryPosition,t=h(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(r);var p=function(e){if(e.collapsed)return g(new a(e.startContainer,e.startOffset),!0);var t=g(new a(e.startContainer,e.startOffset),!0),n=g(new a(e.endContainer,e.endOffset),!1),r=l(s.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};if(r.rangeToTextRange=p,r.prototype.toTextRange=function(){return p(this)},e.WrappedTextRange=r,!e.features.implementsDomRange||e.config.preferTextRange){var m=Function("return this;")();void 0===m.Range&&(m.Range=r),e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=c(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=c(e,t,"createRangyRange"),new s(e)},i.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),i.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener((function(t){var n=t.document;void 0===n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null}))})),E.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],(function(e,t){e.config.checkSelectionRanges=!0;var n,r,o="boolean",i="number",a=e.dom,s=e.util,l=s.isHostMethod,c=e.DomRange,d=e.WrappedRange,u=e.DOMException,f=a.DomPosition,h=e.features,g="Control",p=a.getDocument,m=a.getBody,v=c.rangesEqual;function R(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function C(e,n){if(e){if(a.isWindow(e))return e;if(e instanceof $)return e.win;var r=a.getContentDocument(e,t,n);return a.getWindow(r)}return window}function N(e){return C(e,"getWinSelection").getSelection()}function E(e){return C(e,"getDocSelection").document.selection}function y(e){var t=!1;return e.anchorNode&&(t=1==a.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}var w=l(window,"getSelection"),S=s.isHostObject(document,"selection");h.implementsWinGetSelection=w,h.implementsDocSelection=S;var T=S&&(!w||e.config.preferTextRange);if(T)n=E,e.isSelectionValid=function(e){var t=C(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||p(n.createRange().parentElement())==t};else{if(!w)return t.fail("Neither document.selection or window.getSelection() detected."),!1;n=N,e.isSelectionValid=function(){return!0}}e.getNativeSelection=n;var A=n();if(!A)return t.fail("Native selection was null (possibly issue 138?)"),!1;var x=e.createNativeRange(document),b=m(document),O=s.areHostProperties(A,["anchorNode","focusNode","anchorOffset","focusOffset"]);h.selectionHasAnchorAndFocus=O;var I=l(A,"extend");h.selectionHasExtend=I;var M=typeof A.rangeCount==i;h.selectionHasRangeCount=M;var k=!1,D=!0,_=I?function(t,n){var r=c.getRangeDocument(n),o=e.createRange(r);o.collapseToPoint(n.endContainer,n.endOffset),t.addRange(F(o)),t.extend(n.startContainer,n.startOffset)}:null;s.areHostMethods(A,["addRange","getRangeAt","removeAllRanges"])&&typeof A.rangeCount==i&&h.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,r=n>1,o=[],i=y(t),s=0;s<n;++s)o[s]=t.getRangeAt(s);var l=a.createTestElement(document,"",!1),c=l.appendChild(document.createTextNode("   ")),d=document.createRange();if(d.setStart(c,1),d.collapse(!0),t.removeAllRanges(),t.addRange(d),D=1==t.rangeCount,t.removeAllRanges(),!r){var u=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(u&&parseInt(u[1])>=36)k=!1;else{var f=d.cloneRange();d.setStart(c,0),f.setEnd(c,3),f.setStart(c,2),t.addRange(d),t.addRange(f),k=2==t.rangeCount}}for(a.removeNode(l),t.removeAllRanges(),s=0;s<n;++s)0==s&&i?_?_(t,o[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[s])):t.addRange(o[s])}}(),h.selectionSupportsMultipleRanges=k,h.collapsedNonEditableSelectionsSupported=D;var P,H,L=!1;function B(e,t,n){var r=n?"end":"start",o=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function W(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function z(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function F(t){var n;return t instanceof c?((n=e.createNativeRange(t.getDocument())).setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof d?n=t.nativeRange:h.implementsDomRange&&t instanceof a.getWindow(t.startContainer).Range&&(n=t),n}function V(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;t<n;++t)if(!a.isAncestorOf(e[0],e[t]))return!1;return!0}function j(e){var n=e.getNodes();if(!V(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function Y(e){return!!e&&void 0!==e.text}function U(e,t){var n=new d(t);e._ranges=[n],B(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function q(t){if(t._ranges.length=0,"None"==t.docSelection.type)z(t);else{var n=t.docSelection.createRange();if(Y(n))U(t,n);else{t.rangeCount=n.length;for(var r,o=p(n.item(0)),i=0;i<t.rangeCount;++i)(r=e.createRange(o)).selectNode(n.item(i)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,B(t,t._ranges[t.rangeCount-1],!1)}}}function X(e,n){for(var r=e.docSelection.createRange(),o=j(n),i=p(r.item(0)),a=m(i).createControlRange(),s=0,l=r.length;s<l;++s)a.add(r.item(s));try{a.add(o)}catch(e){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),q(e)}function $(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function G(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}b&&l(b,"createControlRange")&&(P=b.createControlRange(),s.areHostProperties(P,["item","add"])&&(L=!0)),h.implementsControlRange=L,r=O?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},l(A,"getRangeAt")?H=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:O&&(H=function(t){var n=p(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),$.prototype=e.selectionPrototype;var Q=[];function J(e,t){for(var n,r,o=Q.length;o--;)if(r=(n=Q[o]).selection,"deleteAll"==t)G(r);else if(n.win==e)return"delete"==t?(Q.splice(o,1),!0):r;return"deleteAll"==t&&(Q.length=0),null}var Z=function(e){if(e&&e instanceof $)return e.refresh(),e;var t=J(e=C(e,"getNativeSelection")),r=n(e),o=S?E(e):null;return t?(t.nativeSelection=r,t.docSelection=o,t.refresh()):(t=new $(r,o,e),Q.push({win:e,selection:t})),t};e.getSelection=Z,s.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var K,ee=$.prototype;function te(e,n){for(var r,o=p(n[0].startContainer),i=m(o).createControlRange(),a=0,s=n.length;a<s;++a){r=j(n[a]);try{i.add(r)}catch(e){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),q(e)}if(!T&&O&&s.areHostMethods(A,["removeAllRanges","addRange"])){ee.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),z(this)};var ne=function(e,t){_(e.nativeSelection,t),e.refresh()};ee.addRange=M?function(t,n){if(L&&S&&this.docSelection.type==g)X(this,t);else if(R(n)&&I)ne(this,t);else{var o;k?o=this.rangeCount:(this.removeAllRanges(),o=0);var i=F(t).cloneRange();try{this.nativeSelection.addRange(i)}catch(e){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var a=H(this.nativeSelection,this.rangeCount-1);a&&!v(a,t)&&(t=new d(a))}this._ranges[this.rangeCount-1]=t,B(this,t,re(this.nativeSelection)),this.isCollapsed=r(this)}else this.refresh()}}:function(e,t){R(t)&&I?ne(this,e):(this.nativeSelection.addRange(F(e)),this.refresh())},ee.setRanges=function(e){if(L&&S&&e.length>1)te(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(l(A,"empty")&&l(x,"select")&&L&&T))return t.fail("No means of selecting a Range or TextRange was found"),!1;ee.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=p(this.anchorNode);else if(this.docSelection.type==g){var t=this.docSelection.createRange();t.length&&(e=p(t.item(0)))}e&&(m(e).createTextRange().select(),this.docSelection.empty())}}catch(e){}z(this)},ee.addRange=function(t){this.docSelection.type==g?X(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,B(this,t,!1))},ee.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?te(this,e):t&&this.addRange(e[0])}}if(ee.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new u("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},T)K=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=m(t.win.document).createTextRange()).collapse(!0),t.docSelection.type==g?q(t):Y(n)?U(t,n):z(t)};else if(l(A,"getRangeAt")&&typeof A.rangeCount==i)K=function(t){if(L&&S&&t.docSelection.type==g)q(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,o=t.rangeCount;n<o;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));B(t,t._ranges[t.rangeCount-1],re(t.nativeSelection)),t.isCollapsed=r(t)}else z(t)};else{if(!O||typeof A.isCollapsed!=o||typeof x.collapsed!=o||!h.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;K=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=H(n,0),e._ranges=[t],e.rangeCount=1,W(e),e.isCollapsed=r(e)):z(e)}}ee.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;if(K(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;for(;o--;)if(!v(t[o],this._ranges[o]))return!0;return!1}};var re,oe=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,o=n.length;r<o;++r)v(t,n[r])||e.addRange(n[r]);e.rangeCount||z(e)};function ie(e,t){if(e.win.document!=p(t))throw new u("WRONG_DOCUMENT_ERR")}function ae(t){return function(n,r){var o;this.rangeCount?(o=this.getRangeAt(0))["set"+(t?"Start":"End")](n,r):(o=e.createRange(this.win.document)).setStartAndEnd(n,r),this.setSingleRange(o,this.isBackward())}}function se(e){var t=[],n=new f(e.anchorNode,e.anchorOffset),r=new f(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var i=0,a=e.rangeCount;i<a;++i)t[i]=c.inspect(e.getRangeAt(i));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}ee.removeRange=L&&S?function(e){if(this.docSelection.type==g){for(var t=this.docSelection.createRange(),n=j(e),r=p(t.item(0)),o=m(r).createControlRange(),i=!1,a=0,s=t.length;a<s;++a)t.item(a)!==n||i?o.add(t.item(a)):i=!0;o.select(),q(this)}else oe(this,e)}:function(e){oe(this,e)},!T&&O&&h.implementsDomRange?(re=y,ee.isBackward=function(){return re(this)}):re=ee.isBackward=function(){return!1},ee.isBackwards=ee.isBackward,ee.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},ee.collapse=function(t,n){ie(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},ee.collapseToStart=function(){if(!this.rangeCount)throw new u("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},ee.collapseToEnd=function(){if(!this.rangeCount)throw new u("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},ee.selectAllChildren=function(t){ie(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},ee.deleteFromDocument=function(){if(L&&S&&this.docSelection.type==g){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),a.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,o=n.length;r<o;++r)n[r].deleteContents();this.addRange(n[o-1])}}},ee.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(e(this.getRangeAt(n)))return t},ee.getAllRanges=function(){var e=[];return this.eachRange((function(t){e.push(t)})),e},ee.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},ee.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange((function(r){n.push(r[e].apply(r,t||[]))})),n},ee.setStart=ae(!0),ee.setEnd=ae(!1),e.rangePrototype.select=function(e){Z(this.getDocument()).setSingleRange(this,e)},ee.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange((function(n){e(n),t.push(n)})),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},ee.containsNode=function(e,t){return this.eachRange((function(n){return n.containsNode(e,t)}),!0)||!1},ee.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},ee.moveToBookmark=function(t){for(var n,r,o=[],i=0;n=t.rangeBookmarks[i++];)(r=e.createRange(this.win)).moveToBookmark(n),o.push(r);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},ee.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},ee.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},ee.toHtml=function(){var e=[];return this.eachRange((function(t){e.push(c.toHtml(t))})),e.join("")},h.implementsTextRange&&(ee.getNativeTextRange=function(){var n;if(n=this.docSelection){var r=n.createRange();if(Y(r))return r;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),ee.getName=function(){return"WrappedSelection"},ee.inspect=function(){return se(this)},ee.detach=function(){J(this.win,"delete"),G(this)},$.detachAll=function(){J(null,"deleteAll")},$.inspect=se,$.isDirectionBackward=R,e.Selection=$,e.selectionPrototype=ee,e.addShimListener((function(e){void 0===e.getSelection&&(e.getSelection=function(){return Z(e)}),e=null}))}));var L=!1,B=function(e){L||(L=!0,!E.initialized&&E.config.autoInitialize&&b())};return C&&("complete"==document.readyState?B():(s(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",B,!1),v(window,"load",B))),E},void 0===(o="function"==typeof r?r.call(t,n,t,e):r)||(e.exports=o)},392:function(e,t,n){var r,o,i;o=[n(946)],void 0===(i="function"==typeof(r=function(e){return e.createModule("Highlighter",["ClassApplier"],(function(e,t){var n=e.dom,r=n.arrayContains,o=n.getBody,i=e.util.createOptions,a=e.util.forEach,s=1;function l(e,t){return e.characterRange.start-t.characterRange.start}function c(e,t){return t?e.getElementById(t):o(e)}var d={};function u(e,t){this.type=e,this.converterCreator=t}function f(e,t){d[e]=new u(e,t)}function h(e){var t=d[e];if(t instanceof u)return t.create();throw new Error("Highlighter type '"+e+"' is not valid")}function g(e,t){this.start=e,this.end=t}u.prototype.create=function(){var e=this.converterCreator();return e.type=this.type,e},e.registerHighlighterType=f,g.prototype={intersects:function(e){return this.start<e.end&&this.end>e.start},isContiguousWith:function(e){return this.start==e.end||this.end==e.start},union:function(e){return new g(Math.min(this.start,e.start),Math.max(this.end,e.end))},intersection:function(e){return new g(Math.max(this.start,e.start),Math.min(this.end,e.end))},getComplements:function(e){var t=[];if(this.start>=e.start){if(this.end<=e.end)return[];t.push(new g(e.end,this.end))}else t.push(new g(this.start,Math.min(this.end,e.start))),this.end>e.end&&t.push(new g(e.end,this.end));return t},toString:function(){return"[CharacterRange("+this.start+", "+this.end+")]"}},g.fromCharacterRange=function(e){return new g(e.start,e.end)};var p,m={rangeToCharacterRange:function(e,t){var n=e.getBookmark(t);return new g(n.start,n.end)},characterRangeToRange:function(t,n,r){var o=e.createRange(t);return o.moveToBookmark({start:n.start,end:n.end,containerNode:r}),o},serializeSelection:function(e,t){for(var n=e.getAllRanges(),r=[],o=1==n.length&&e.isBackward(),i=0,a=n.length;i<a;++i)r[i]={characterRange:this.rangeToCharacterRange(n[i],t),backward:o};return r},restoreSelection:function(e,t,n){e.removeAllRanges();for(var r,o,i=e.win.document,a=0,s=t.length;a<s;++a)(o=t[a]).characterRange,r=this.characterRangeToRange(i,o.characterRange,n),e.addRange(r,o.backward)}};function v(e,t,n,r,o,i){o?(this.id=o,s=Math.max(s,o+1)):this.id=s++,this.characterRange=t,this.doc=e,this.classApplier=n,this.converter=r,this.containerElementId=i||null,this.applied=!1}function R(e,t){t=t||"textContent",this.doc=e||document,this.classAppliers={},this.highlights=[],this.converter=h(t)}f("textContent",(function(){return m})),f("TextRange",(function(){if(!p){var t=e.modules.TextRange;if(!t)throw new Error("TextRange module is missing.");if(!t.supported)throw new Error("TextRange module is present but not supported.");p={rangeToCharacterRange:function(e,t){return g.fromCharacterRange(e.toCharacterRange(t))},characterRangeToRange:function(t,n,r){var o=e.createRange(t);return o.selectCharacters(r,n.start,n.end),o},serializeSelection:function(e,t){return e.saveCharacterRanges(t)},restoreSelection:function(e,t,n){e.restoreCharacterRanges(n,t)}}}return p})),v.prototype={getContainerElement:function(){return c(this.doc,this.containerElementId)},getRange:function(){return this.converter.characterRangeToRange(this.doc,this.characterRange,this.getContainerElement())},fromRange:function(e){this.characterRange=this.converter.rangeToCharacterRange(e,this.getContainerElement())},getText:function(){return this.getRange().toString()},containsElement:function(e){return this.getRange().containsNodeContents(e.firstChild)},unapply:function(){this.hasNote=!1,this.classApplier.undoToRange(this.getRange()),this.applied=!1},apply:function(){this.classApplier.applyToRange(this.getRange()),this.applied=!0},changeClassApplier:function(e){var t=this.getHighlightElements(),n=this.classApplier.className,r=e.className;this.classApplier=e,this.applied&&t&&t.forEach((e=>e.classList.replace(n,r)))},getHighlightElements:function(){return this.classApplier.getElementsWithClassIntersectingRange(this.getRange())},toString:function(){return"[Highlight(ID: "+this.id+", class: "+this.classApplier.className+", character range: "+this.characterRange.start+" - "+this.characterRange.end+")]"},set hasNote(e){this.XhasNote=e,e?this.addCustomClass():this.removeCustomClass()},get hasNote(){return this.XhasNote||!1},addCustomClass:function(){var e=this.getHighlightElements();e&&e.forEach((e=>e.classList.add("marker-note")))},removeCustomClass:function(){var e=this.getHighlightElements();e&&e.forEach((e=>e.classList.remove("marker-note")))}},R.prototype={addClassApplier:function(e){this.classAppliers[e.className]=e},getHighlightForElement:function(e){for(var t=this.highlights,n=0,r=t.length;n<r;++n)if(t[n].containsElement(e))return t[n];return null},removeHighlights:function(e){for(var t,n=0,o=this.highlights.length;n<o;++n)t=this.highlights[n],r(e,t)&&(t.unapply(),this.highlights.splice(n--,1))},removeAllHighlights:function(){this.removeHighlights(this.highlights)},getIntersectingHighlights:function(e){var t=[],n=this.highlights;return a(e,(function(e){a(n,(function(n){e.intersectsRange(n.getRange())&&!r(t,n)&&t.push(n)}))})),t},highlightCharacterRanges:function(t,n,r){var o,s,l,c,d,u,f,h,p,m,R,C,N=this.highlights,E=this.converter,y=this.doc,w=[],S=t?this.classAppliers[t]:null,T=(r=i(r,{containerElementId:null,exclusive:!0})).containerElementId,A=r.exclusive;for(T&&(c=this.doc.getElementById(T))&&((d=e.createRange(this.doc)).selectNodeContents(c),u=new g(0,d.toString().length)),o=0,s=n.length;o<s;++o)if(f=n[o],R=[],u&&(f=f.intersection(u)),f.start!=f.end){for(l=0;l<N.length;++l)p=!1,T==N[l].containerElementId&&(h=N[l].characterRange,C=!(m=S==N[l].classApplier)&&A,(h.intersects(f)||h.isContiguousWith(f))&&(m||C)&&(C&&a(h.getComplements(f),(function(e){R.push(new v(y,e,N[l].classApplier,E,null,T))})),p=!0,m&&(f=h.union(f)))),p?(w.push(N[l]),N[l]=new v(y,h.union(f),S,E,null,T)):R.push(N[l]);S&&R.push(new v(y,f,S,E,null,T)),this.highlights=N=R}a(w,(function(e){e.unapply()})),r.onHighlightsRemove&&r.onHighlightsRemove(w);var x=[];return a(N,(function(e){e.applied||(e.apply(),x.push(e))})),x},highlightRanges:function(t,n,r){var s,l=[],c=this.converter,d=(r=i(r,{containerElement:null,exclusive:!0})).containerElement,u=d?d.id:null;return d&&(s=e.createRange(d)).selectNodeContents(d),a(n,(function(e){var t=d?s.intersection(e):e;l.push(c.rangeToCharacterRange(t,d||o(e.getDocument())))})),this.highlightCharacterRanges(t,l,{containerElementId:u,exclusive:r.exclusive,onHighlightsRemove:r.onHighlightsRemove})},highlightSelection:function(t,n){var r=this.converter,o=!!t&&this.classAppliers[t],s=(n=i(n,{containerElementId:null,exclusive:!0})).containerElementId,l=n.exclusive,d=n.selection||e.getSelection(this.doc),u=c(d.win.document,s);if(!o&&!1!==t)throw new Error("No class applier found for class '"+t+"'");var f=r.serializeSelection(d,u),h=[];a(f,(function(e){h.push(g.fromCharacterRange(e.characterRange))}));var p=this.highlightCharacterRanges(t,h,{containerElementId:s,exclusive:l,onHighlightsRemove:n.onHighlightsRemove});return r.restoreSelection(d,f,u),p},unhighlightSelection:function(t){t=t||e.getSelection(this.doc);var n=this.getIntersectingHighlights(t.getAllRanges());return this.removeHighlights(n),t.removeAllRanges(),n},getHighlightsInSelection:function(t){return t=t||e.getSelection(this.doc),this.getIntersectingHighlights(t.getAllRanges())},selectionOverlapsHighlight:function(e){return this.getHighlightsInSelection(e).length>0},serialize:function(e){var t,n,r,o,s=this,c=s.highlights;return c.sort(l),t=(e=i(e,{serializeHighlightText:!1,type:s.converter.type})).type,(r=t!=s.converter.type)&&(o=h(t)),n=["type:"+t],a(c,(function(t){var i,a=t.characterRange;r&&(i=t.getContainerElement(),a=o.rangeToCharacterRange(s.converter.characterRangeToRange(s.doc,a,i),i));var l=[a.start,a.end,t.id,t.classApplier.className,t.containerElementId];e.serializeHighlightText&&l.push(t.getText()),n.push(l.join("$"))})),n.join("|")},deserialize:function(e){var t,n,r,o,i,a,s,l,d=e.split("|"),u=[],f=d[0],p=!1;if(!f||!(t=/^type:(\w+)$/.exec(f)))throw new Error("Serialized highlights are invalid.");(n=t[1])!=this.converter.type&&(r=h(n),p=!0),d.shift();for(var m,R=d.length;R-- >0;){if(a=new g(+(m=d[R].split("$"))[0],+m[1]),s=m[4]||null,p&&(l=c(this.doc,s),a=this.converter.rangeToCharacterRange(r.characterRangeToRange(this.doc,a,l),l)),!(o=this.classAppliers[m[3]]))throw new Error("No class applier found for class '"+m[3]+"'");(i=new v(this.doc,a,o,this.converter,parseInt(m[2]),s)).apply(),u.push(i)}this.highlights=u}},e.Highlighter=R,e.createHighlighter=function(e,t){return new R(e,t)}})),e})?r.apply(t,o):r)||(e.exports=i)},537:(e,t,n)=>{n(76)}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n(537)})();